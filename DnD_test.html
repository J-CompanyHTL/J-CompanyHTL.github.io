<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>DnD Battlemap</title>
    <style>
      #canvas {
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <button onclick="addToken()">Token hinzufügen</button>
    <button onclick="removeToken()">Token entfernen</button>
    <canvas id="canvas" width="800" height="600"></canvas>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const gridSize = 50; // Größe eines Rasters in Pixel
      const tokens = [];
      let selectedTokens = []; // Tokens, zwischen denen der Abstand gemessen wird

      function drawGrid() {
        for (let x = 0; x < canvas.width; x += gridSize) {
          for (let y = 0; y < canvas.height; y += gridSize) {
            ctx.strokeRect(x, y, gridSize, gridSize);
          }
        }
      }

      function drawTokens() {
        tokens.forEach((token) => {
          ctx.fillStyle = "red";
          ctx.fillRect(
            token.x * gridSize,
            token.y * gridSize,
            gridSize,
            gridSize
          );
        });
      }

      function drawDistance() {
        if (selectedTokens.length === 2) {
          const [token1, token2] = selectedTokens;
          const x1 = token1.x * gridSize + gridSize / 2;
          const y1 = token1.y * gridSize + gridSize / 2;
          const x2 = token2.x * gridSize + gridSize / 2;
          const y2 = token2.y * gridSize + gridSize / 2;

          // Draw line
          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.strokeStyle = "blue";
          ctx.stroke();

          // Calculate distance
          const distance =
            Math.sqrt(
              Math.pow(token2.x - token1.x, 2) +
                Math.pow(token2.y - token1.y, 2)
            ) * 5;
          ctx.fillStyle = "black";
          ctx.fillText(`Distance: ${distance}ft`, (x1 + x2) / 2, (y1 + y2) / 2);
        }
      }

      function updateCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        drawTokens();
        drawDistance();
      }

      canvas.addEventListener("click", (event) => {
        const rect = canvas.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        const clickedToken = tokens.find(
          (token) =>
            x >= token.x * gridSize &&
            x < (token.x + 1) * gridSize &&
            y >= token.y * gridSize &&
            y < (token.y + 1) * gridSize
        );

        if (clickedToken) {
          if (selectedTokens.includes(clickedToken)) {
            selectedTokens = selectedTokens.filter(
              (token) => token !== clickedToken
            );
          } else if (selectedTokens.length < 2) {
            selectedTokens.push(clickedToken);
          } else {
            selectedTokens = [clickedToken];
          }
          updateCanvas();
        }
      });

      drawGrid();
    </script>
  </body>
</html>
